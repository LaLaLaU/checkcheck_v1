# CheckCheck 导管喷码自动核对系统 - 产品需求文档 (PRD)

**版本**: 1.1
**日期**: 2025-04-26
**作者**: AI助手
**更新说明**: V1.1 - 调整实施优先级，优先开发图片上传识别功能，相机相关功能推迟。

## 1. 产品概述

CheckCheck是一个基于计算机视觉和OCR技术的导管喷码自动核对系统，旨在提高导管喷码与金属标牌文字核对的效率和准确性。系统通过工业相机同时捕获金属标牌和管身喷码，自动识别并比对两处文字，实现高效、准确的核对工作。

### 1.1 产品目标

- 替代人工核对，提高效率
- 实现99%以上的核对准确率
- 支持连续工作，满足生产线需求
- 提供友好的用户界面和操作体验

### 1.2 目标用户

- 导管生产线质检人员
- 生产线管理人员

## 2. 系统架构

### 2.1 硬件配置

- **工业相机**: WELLIMAGE WI-U9509C (2592×1944/5MP, USB/UVC接口)
- **照明设备**: 环形照明
- **计算机要求**: 
  - Windows 10/11操作系统
  - Intel i5处理器或同等性能
  - 8GB以上内存
  - USB 3.0接口

### 2.2 软件架构

- **开发语言**: Python 3.8+
- **GUI框架**: PyQt5
- **核心技术组件**:
  - OpenCV: 图像处理和视频流获取
  - PaddleOCR: 文字识别
  - NumPy: 数据处理
  - Difflib: 文本比对

## 3. 功能需求

### 3.1 基础功能

#### 3.1.1 相机控制 (**注意：实施已推迟**)
- 实时显示工业相机视频流
- 支持相机参数调整（分辨率、曝光、对比度等）
- 自动检测画面变化，触发识别流程

#### 3.1.2 图像处理
- 自动检测标牌和喷码区域 (**初期基于上传图片实现**)
- 图像预处理（去噪、锐化、对比度增强等）
- 支持可变位置的标牌和喷码识别

#### 3.1.3 OCR识别
- 识别中英文混合文本
- 支持特殊格式文本（如"燃油 ABCD.1234.E.888.999"）
- 显示识别结果和置信度

#### 3.1.4 文本比对
- 计算两处文字的相似度
- 高亮显示不匹配部分
- 根据相似度阈值判断是否通过

#### 3.1.5 结果记录
- 保存比对结果（包括时间、图像、文字内容、比对结果）
- 支持结果查询和导出
- 统计分析功能（通过率、错误类型等）

### 3.2 扩展功能 (**调整：部分功能提前用于初期开发与测试**)

#### 3.2.1 图片上传识别 (**提升优先级：作为初期核心功能开发和测试入口**)
- 支持从本地上传图片进行识别和比对
- 支持批量处理功能
- 提供图片预处理选项

#### 3.2.2 用户管理
- 多级用户权限（管理员、操作员）
- 用户登录和操作日志

#### 3.2.3 系统设置
- OCR参数配置
- 比对阈值设置
- 系统行为设置（自动保存、提示音等）

## 4. 用户界面

### 4.1 主界面

- **~~视频预览区~~ 图片显示区**: **(初期)** 显示用户上传的图片。**(后期)** 显示实时相机画面。
- **识别结果区**:
  - 标牌文字显示
  - 喷码文字显示
  - 比对结果显示（通过/不通过，相似度）
- **操作控制区**:
  - **(初期)** 上传图片按钮, 开始识别按钮 (针对图片)
  - **(后期)** 开始/暂停按钮 (针对视频流), 手动触发按钮
  - 设置按钮
  - 历史记录按钮

### 4.2 设置界面

- **相机设置**: 分辨率、帧率、曝光等参数 (**注意：实施已推迟**)
- **OCR设置**: 识别模型、置信度阈值等
- **比对设置**: 相似度阈值、匹配模式等
- **系统设置**: 自动保存、提示音、界面主题等

### 4.3 历史记录界面

- 历史比对结果列表
- 筛选和搜索功能
- 详细结果查看
- 数据导出功能
- 图片预览功能

### 4.4 图片上传界面

- 文件选择器
- 拖放区域
- 批量处理控制
- 预处理选项

## 5. 非功能需求

### 5.1 性能需求

- 实时视频流显示帧率≥20fps
- OCR识别准确率≥99%
- 单次识别和比对时间≤2秒
- 系统响应时间≤0.5秒

### 5.2 可靠性需求

- 系统连续工作时间≥8小时
- 崩溃恢复机制
- 数据备份和恢复功能

### 5.3 安全性需求

- 用户身份验证
- 操作日志记录
- 数据加密存储

### 5.4 可用性需求

- 简洁直观的用户界面
- 清晰的错误提示
- 完善的用户帮助文档

## 6. 技术实现方案

### 6.1 自动区域检测

- 使用MSER (Maximally Stable Extremal Regions) 算法检测文本区域
- 结合轮廓分析和形状特征识别标牌区域
- 使用DBNet文本检测算法提高检测准确率

### 6.2 OCR优化策略

- 使用PaddleOCR-v2中文识别模型
- 针对特定格式文本的识别优化
- 使用图像预处理提高识别准确率

### 6.3 高精度比对算法

- 使用编辑距离算法计算文本相似度
- 考虑字符位置和类型的加权比对
- 针对特定格式实现智能分段比对

## 7. 项目实施计划 (**调整后**)

### 7.1 阶段一：基础框架与图片上传 (1周)
- 搭建开发环境
- **实现图片加载与显示**
- 设计用户界面原型 (**包含图片上传**)

### 7.2 阶段二：核心功能开发 (基于图片) (2-3周)
- 实现自动区域检测算法 (**基于图片**)
- 集成PaddleOCR引擎
- 开发文本比对算法

### 7.3 阶段三：用户界面与核心功能集成 (1-2周)
- 实现主界面 (**图片处理流程**) 和设置界面 (**不含相机**)
- 实现结果展示和历史记录功能
- 集成核心功能模块

### 7.4 阶段四：系统测试和优化 (基于图片) (1周)
- 进行准确率测试 (**基于图片**)
- 性能优化
- 修复问题和改进

### 7.5 阶段五：打包、文档与交付 (初期版本) (1周)
- 系统打包 (**基于图片处理功能**) 和部署
- 编写用户手册
- 培训和技术支持

### **7.6 阶段六：相机功能集成与测试 (待相机到货后)**
- **实现相机视频流获取与控制**
- **集成相机功能到主界面和设置界面**
- **进行完整的系统测试 (包含相机)**
- **更新打包与文档**

## 8. 风险评估

| 风险 | 影响 | 可能性 | 缓解措施 |
|------|------|--------|----------|
| OCR识别准确率不达标 | 高 | 中 | 使用多模型集成，针对特定场景优化 |
| 自动区域检测不准确 | 高 | 中 | 提供手动调整选项，优化检测算法 |
| 系统性能不足 | 中 | 低 | 优化代码，提高硬件配置要求 |
| 用户操作复杂 | 中 | 低 | 简化界面，提供详细操作指南 |

## 9. 验收标准

- OCR识别准确率≥99%
- 比对正确率≥99%
- 单次识别和比对时间≤1秒
- 系统连续工作≥8小时无故障
- 用户界面满足易用性要求
- 所有功能按需求规格正常工作

## 10. 附录

### 10.1 术语表

- **OCR**: Optical Character Recognition，光学字符识别
- **UVC**: USB Video Class，USB视频类设备
- **GUI**: Graphical User Interface，图形用户界面
- **MSER**: Maximally Stable Extremal Regions，最大稳定极值区域

### 10.2 参考资料

- PaddleOCR官方文档
- OpenCV官方文档
- PyQt5官方文档
- 工业相机WELLIMAGE WI-U9509C规格说明书
